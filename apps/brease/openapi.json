{
  "openapi": "3.0.1",
  "info": {
    "title": "brease API",
    "description": "Business rule engine as a service API spec.",
    "contact": {
      "name": "Brease API Support",
      "url": "https://app.brease.run/support",
      "email": "support@dot.industries"
    },
    "version": "0.1.0"
  },
  "servers": [
    {
      "url": "http://localhost:4400",
      "description": "Development server"
    },
    {
      "url": "https://api.brease.run",
      "description": "Cloud hosted production server"
    }
  ],
  "paths": {
    "/{contextID}/evaluate": {
      "post": {
        "tags": [
          "contextID"
        ],
        "description": "Evaluate rules within a context on the provided object",
        "operationId": "evaluateRules",
        "parameters": [
          {
            "name": "contextID",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EvaluateRulesInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiEvaluateRulesResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "apiToken": []
          }
        ]
      }
    },
    "/{contextID}/rules": {
      "get": {
        "tags": [
          "contextID"
        ],
        "description": "Returns all rules with the context",
        "operationId": "getAllRules",
        "parameters": [
          {
            "name": "contextID",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiAllRulesResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "apiToken": []
          }
        ]
      }
    },
    "/{contextID}/rules/add": {
      "post": {
        "tags": [
          "contextID"
        ],
        "description": "Adds a new rule to the context",
        "operationId": "addRule",
        "parameters": [
          {
            "name": "contextID",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddRuleInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiAddRuleResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "apiToken": []
          }
        ]
      }
    },
    "/{contextID}/rules/{id}": {
      "put": {
        "tags": [
          "contextID"
        ],
        "description": "Replaces an existing rule within the context",
        "operationId": "replaceRule",
        "parameters": [
          {
            "name": "contextID",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReplaceRuleInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiReplaceRuleResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "apiToken": []
          }
        ]
      },
      "delete": {
        "tags": [
          "contextID"
        ],
        "description": "Removes a rule from the context",
        "operationId": "removeRule",
        "parameters": [
          {
            "name": "contextID",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        },
        "security": [
          {
            "apiToken": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "AddRuleInput": {
        "type": "object",
        "properties": {
          "rule": {
            "$ref": "#/components/schemas/ModelsRule"
          }
        }
      },
      "ApiAddRuleResponse": {
        "type": "object",
        "properties": {
          "rule": {
            "$ref": "#/components/schemas/ModelsRule"
          }
        }
      },
      "ApiAllRulesResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string"
          },
          "rules": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ModelsRule"
            }
          }
        }
      },
      "ApiEvaluateRulesResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ModelsEvaluationResult"
            }
          }
        }
      },
      "ApiReplaceRuleResponse": {
        "type": "object",
        "properties": {
          "rule": {
            "$ref": "#/components/schemas/ModelsRule"
          }
        }
      },
      "EvaluateRulesInput": {
        "type": "object",
        "properties": {
          "object": {
            "type": "object",
            "additionalProperties": {}
          },
          "overrideCode": {
            "type": "string"
          },
          "overrideRules": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ModelsRule"
            }
          }
        },
        "required": [
          "object"
        ]
      },
      "ModelsEvaluationResult": {
        "type": "object",
        "properties": {
          "Value": {
            "type": "string"
          },
          "action": {
            "type": "string"
          },
          "actionTargetType": {
            "type": "string"
          },
          "targetID": {
            "type": "string"
          }
        }
      },
      "ExpressionArray": {
        "type": "object",
        "properties": {
          "expression": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Expression"
            }
          }
        }
      },
      "ConditionBaseKey": {
        "type": "object",
        "properties": {
          "key": {
            "type": "string"
          }
        }
      },
      "ConditionBaseRef": {
        "type": "object",
        "properties": {
          "src": {
            "type": "string"
          },
          "dst": {
            "type": "string"
          }
        }
      },
      "ConditionBase": {
        "oneOf": [
          {
            "$ref": "#/components/schemas/ConditionBaseKey"
          },
          {
            "properties": {
              "ref": {
                "$ref": "#/components/schemas/ConditionBaseRef"
              }
            }
          }
        ]
      },
      "ConditionParameterString": {
        "type": "string"
      },
      "ConditionParameterBoolean": {
        "type": "boolean"
      },
      "ConditionParameterInt": {
        "type": "integer"
      },
      "ConditionParameter": {
        "oneOf": [
          {
            "$ref": "#/components/schemas/ConditionParameterString"
          },
          {
            "$ref": "#/components/schemas/ConditionParameterBoolean"
          },
          {
            "$ref": "#/components/schemas/ConditionParameterInt"
          }
        ]
      },
      "ConditionType": {
        "type": "string",
        "enum": ["e", "hv", "eq", "neq", "px", "npx", "sx", "nsx", "in", "nin", "rgx", "nrgx"]
      },
      "Condition": {
        "type": "object",
        "properties": {
          "base": {
            "$ref": "#/components/schemas/ConditionBase"
          },
          "type": {
            "$ref": "#/components/schemas/ConditionType"
          },
          "parameter": {
            "$ref": "#/components/schemas/ConditionParameter"
          }
        }
      },
      "Expression": {
        "type": "object",
        "oneOf": [
          {
            "properties": {
              "and": {
                "$ref": "#/components/schemas/ExpressionArray"
              }
            }
          },
          {
            "properties": {
              "or": {
                "$ref": "#/components/schemas/ExpressionArray"
              }
            }
          },
          {
            "properties": {
              "condition": {
                "$ref": "#/components/schemas/Condition"
              }
            }
          }
        ]
      },
      "ModelsRule": {
        "type": "object",
        "properties": {
          "action": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "expression": {
            "$ref": "#/components/schemas/Expression"
          },
          "id": {
            "type": "string"
          },
          "target": {
            "$ref": "#/components/schemas/ModelsTarget"
          }
        },
        "required": [
          "action",
          "expression",
          "id",
          "target"
        ]
      },
      "ModelsTarget": {
        "type": "object",
        "properties": {
          "target": {
            "type": "string"
          },
          "targetValue": {
            "type": "string"
          },
          "type": {
            "type": "string"
          }
        },
        "required": [
          "target",
          "type"
        ]
      },
      "ReplaceRuleInput": {
        "type": "object",
        "properties": {
          "rule": {
            "$ref": "#/components/schemas/ModelsRule"
          }
        },
        "required": [
          "rule"
        ]
      }
    },
    "securitySchemes": {
      "apiToken": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "tags": [
    {
      "name": "contextID",
      "description": "Rule domain context"
    }
  ]
}